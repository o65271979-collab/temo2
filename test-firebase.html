<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Firebase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase</h1>
        
        <div id="status" class="status info">
            Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„...
        </div>
        
        <div id="details"></div>
        
        <button onclick="testFirebaseConnection()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
        <button onclick="testAuth()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</button>
        <button onclick="testFirestore()">Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAtCV2XfOJwLy050kHg5y_Oqy-9NfKyOlc",
            authDomain: "temo-a8e65.firebaseapp.com",
            projectId: "temo-a8e65",
            storageBucket: "temo-a8e65.firebasestorage.app",
            messagingSenderId: "897974034557",
            appId: "1:897974034557:web:fcb74ee2c9e9b73def1114",
            measurementId: "G-EVZ5JG42TS"
        };

        let app, auth, db;
        const statusDiv = document.getElementById('status');
        const detailsDiv = document.getElementById('details');

        function updateStatus(message, type = 'info') {
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }

        function addDetail(message) {
            const p = document.createElement('p');
            p.textContent = message;
            detailsDiv.appendChild(p);
        }

        // Initialize Firebase
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            updateStatus('ØªÙ… ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            addDetail('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Firebase SDK');
            addDetail('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚');
        } catch (error) {
            updateStatus('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase: ' + error.message, 'error');
            console.error('Firebase initialization error:', error);
        }

        function testFirebaseConnection() {
            updateStatus('Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...', 'info');
            detailsDiv.innerHTML = '';
            
            try {
                addDetail('ðŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase:');
                addDetail(`Project ID: ${firebaseConfig.projectId}`);
                addDetail(`Auth Domain: ${firebaseConfig.authDomain}`);
                addDetail(`API Key: ${firebaseConfig.apiKey.substring(0, 10)}...`);
                
                if (app) {
                    addDetail('âœ… Firebase App Ù…ØªØ§Ø­');
                    updateStatus('Firebase Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                } else {
                    updateStatus('Ø®Ø·Ø£: Firebase App ØºÙŠØ± Ù…ØªØ§Ø­', 'error');
                }
            } catch (error) {
                updateStatus('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message, 'error');
            }
        }

        function testAuth() {
            updateStatus('Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©...', 'info');
            
            try {
                if (auth) {
                    addDetail('âœ… Firebase Auth Ù…ØªØ§Ø­');
                    
                    auth.onAuthStateChanged((user) => {
                        if (user) {
                            addDetail(`âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${user.email}`);
                            updateStatus('Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                        } else {
                            addDetail('â„¹ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„');
                            updateStatus('Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù…ØªØ§Ø­Ø© (Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…)', 'info');
                        }
                    });
                } else {
                    updateStatus('Ø®Ø·Ø£: Firebase Auth ØºÙŠØ± Ù…ØªØ§Ø­', 'error');
                }
            } catch (error) {
                updateStatus('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©: ' + error.message, 'error');
            }
        }

        async function testFirestore() {
            updateStatus('Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
            
            try {
                if (db) {
                    addDetail('âœ… Firestore Ù…ØªØ§Ø­');
                    
                    // Test reading collections
                    const collections = [
                        'shifts', 
                        'reports', 
                        'sales_reports', 
                        'comprehensive_reports', 
                        'expenses', 
                        'users'
                    ];
                    
                    let totalCounts = {
                        shifts: 0,
                        reports: 0,
                        expenses: 0,
                        users: 0
                    };
                    
                    for (const collectionName of collections) {
                        try {
                            const snapshot = await db.collection(collectionName).get();
                            addDetail(`âœ… Ù…Ø¬Ù…ÙˆØ¹Ø© ${collectionName}: ${snapshot.size} Ø¹Ù†ØµØ±`);
                            
                            // Count totals
                            if (collectionName === 'shifts') {
                                totalCounts.shifts = snapshot.size;
                            } else if (collectionName.includes('report')) {
                                totalCounts.reports += snapshot.size;
                            } else if (collectionName === 'expenses') {
                                totalCounts.expenses = snapshot.size;
                            } else if (collectionName === 'users') {
                                totalCounts.users = snapshot.size;
                            }
                            
                            // Show sample data if exists
                            if (snapshot.size > 0) {
                                const firstDoc = snapshot.docs[0];
                                const data = firstDoc.data();
                                addDetail(`   ðŸ“„ Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${JSON.stringify(Object.keys(data)).substring(0, 100)}...`);
                            }
                        } catch (error) {
                            addDetail(`âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© ${collectionName}: ${error.message}`);
                        }
                    }
                    
                    addDetail('ðŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:');
                    addDetail(`   Ø§Ù„Ø´ÙŠÙØªØ§Øª: ${totalCounts.shifts}`);
                    addDetail(`   Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±: ${totalCounts.reports}`);
                    addDetail(`   Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ: ${totalCounts.expenses}`);
                    addDetail(`   Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ${totalCounts.users}`);
                    
                    updateStatus('Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                } else {
                    updateStatus('Ø®Ø·Ø£: Firestore ØºÙŠØ± Ù…ØªØ§Ø­', 'error');
                }
            } catch (error) {
                updateStatus('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, 'error');
                addDetail(`ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£: ${error.code} - ${error.message}`);
            }
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            setTimeout(testFirebaseConnection, 1000);
        });
    </script>
</body>
</html>
